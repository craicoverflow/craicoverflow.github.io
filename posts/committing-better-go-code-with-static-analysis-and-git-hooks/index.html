<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Committing Better Go Code with Static Analysis and Git Hooks | Enda Phelan</title>

<meta property='og:title' content='Committing Better Go Code with Static Analysis and Git Hooks - Enda Phelan'>
<meta property='og:description' content='An introduction to some popular static analysis tools for Go and how to automate them using Git hooks'>
<meta property='og:url' content='https://endaphelan.me/posts/committing-better-go-code-with-static-analysis-and-git-hooks/'>
<meta property='og:site_name' content='Enda Phelan'>
<meta property='og:type' content='article'><meta property='og:image' content='https://i.imgur.com/UkfFo63.jp2019-02-07g'><meta property='article:published_time' content='2019-03-02T00:00:00Z'/><meta property='article:modified_time' content='2019-03-02T00:00:00Z'/><meta name='twitter:card' content='summary_large_image'><meta name='twitter:site' content='@PhelanEnda'><meta name='twitter:creator' content='@PhelanEnda'>


<link href="https://endaphelan.me/index.xml" rel="alternate" type="application/rss+xml" title="Enda Phelan" />

<link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://endaphelan.me/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://endaphelan.me/posts/committing-better-go-code-with-static-analysis-and-git-hooks/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://endaphelan.me">
          <h1 id="nav-heading" class="title is-4">Enda Phelan</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/craicoverflow'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/PhelanEnda'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="instagram" href='https://instagram.com/enda.phelan'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
    <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:hello@endaphelan.me'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/endaphelan'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/go/">#Go</a>



  
  | <a class="subtitle is-6" href="/tags/git/">#Git</a>
  


      
    </div>
    <h2 class="subtitle is-6">March 2, 2019</h2>
    <h1 class="title">Committing Better Go Code with Static Analysis and Git Hooks</h1>
    
    <div class="content">
      <p><img src=".imgur.com/UkfFo63.jpg" alt=""></p>
<p>I&rsquo;ve been using Go for a while now and there are three static analysis tools (linters) that I use daily. There are <a href="https://github.com/golangci/awesome-go-linters">dozens more</a> that I could be using, but I don&rsquo;t think it&rsquo;s wise to become too dependent on these tools (most of which are unofficial) to do your job for you. Eventually they will become a nightmare to track, maintain and they may eventually become unmaintained or unsupported.</p>
<h3 id="gofmt">Gofmt</h3>
<p><a href="https://golang.org/cmd/gofmt/">Gofmt</a> is an official tool for formatting Go code that has come as part of the language since 2013.</p>
<p>It&rsquo;s as simple as this to format a file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ go fmt main.go
</code></pre></div><p>Or you can target an entire package:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ go fmt ./pkg/models
</code></pre></div><p>To format all packages (excluding <code>vendor</code>) beneath the current directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ go fmt <span style="color:#66d9ef">$(</span>go list ./... | grep -v /vendor/<span style="color:#66d9ef">)</span>
</code></pre></div><h3 id="errcheck">errcheck</h3>
<p>In the maker&rsquo;s own words, <a href="https://github.com/kisielk/errcheck">errcheck</a> &ldquo;checks that you checked errors&rdquo;. In other words, it will scan your code and tell you if there are any errors. This can be useful for those times you sillily forget to run your application after making a small change.</p>
<p>To check errors in a package:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ errcheck ./pkg/models
</code></pre></div><p>Or to scan all packages (excluding <code>vendor</code>) beneath the current directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">errcheck <span style="color:#66d9ef">$(</span>go list ./... | grep -v /vendor/<span style="color:#66d9ef">)</span>
</code></pre></div><h3 id="vet">Vet</h3>
<p>Vet is another official static analysis tool in Go. Vet inspects the source code for suspicious constructs, such as Printf calls whose arguments do not align with the format string.</p>
<p>It&rsquo;s execution is very similar to that of Gofmt.</p>
<p>Vetting a single file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ go vet main.go
</code></pre></div><p>Vetting an entire package:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ go vet ./pkg/models
</code></pre></div><p>Vetting all packages (excluding <code>vendor</code>) beneath the current directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ go fmt <span style="color:#66d9ef">$(</span>go list ./... | grep -v /vendor/<span style="color:#66d9ef">)</span>
</code></pre></div><h2 id="automating-these-tools-with-git-hooks">Automating These Tools With Git Hooks</h2>
<p><a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">Git hooks</a> are a great way to automate these repetitive tasks and ensure you don&rsquo;t commit or push any incomplete code. The hooks are all stored in the <code>.git/hooks</code> subdirectory of your Git project and will automatically execute on or after a pre-defined list of Git events.</p>
<p>For this, we are going to bind to the <code>pre-commit</code> hook as we only want our script to check the files before committing them to Git.</p>
<p>Create a new file in <code>.git/hooks</code> called <code>pre-commit</code> and open it in your favourite editor. Make it executable by running <code>chmod +x .git/hooks/pre-commit</code> from the terminal.</p>
<p>First, let&rsquo;s store the list of files in our project into a variable called <code>FILES</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">FILES<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>go list ./...  | grep -v /vendor/<span style="color:#66d9ef">)</span>
</code></pre></div><p>Add Gofmt next to format your code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">go fmt <span style="color:#e6db74">${</span>FILES<span style="color:#e6db74">}</span>
</code></pre></div><p>Once formatted, the most important thing we need to check for is if there are any errors. If there are we can exit the script and prevent the commit.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">{</span>
	errcheck -ignoretests <span style="color:#e6db74">${</span>FILES<span style="color:#e6db74">}</span>
<span style="color:#f92672">}</span> <span style="color:#f92672">||</span> <span style="color:#f92672">{</span>
	exitStatus<span style="color:#f92672">=</span>$?

	<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $exitStatus <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
		printf <span style="color:#e6db74">&#34;\nErrors found in your code, please fix them and try again.&#34;</span>
		exit <span style="color:#ae81ff">1</span>
	<span style="color:#66d9ef">fi</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>If the code is error-free, the next thing we should check is if there are any suspicious constructs.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">{</span>
	go vet <span style="color:#e6db74">${</span>FILES<span style="color:#e6db74">}</span>
<span style="color:#f92672">}</span> <span style="color:#f92672">||</span> <span style="color:#f92672">{</span>
	exitStatus<span style="color:#f92672">=</span>$?

	<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $exitStatus <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
		printf <span style="color:#e6db74">&#34;\nIssues found in your code, please fix them and try again.&#34;</span>
		exit <span style="color:#ae81ff">1</span>
	<span style="color:#66d9ef">fi</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Here&rsquo;s the complete <code>pre-commit</code> hook. Add this to your project today and start committing better Go code.</p>
<p>{% gist 204d155278099a18877b42b3d5e6a772 %}</p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/posts/a-no-nonsense-guide-to-environment-variables-in-go/">A no-nonsense guide to environment variables in Go</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/craicoverflow">Enda Phelan</a> 2020</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>



</body>
</html>

